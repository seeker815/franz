#!/usr/bin/env ruby
# @author Sean Clemmer
require 'thread'
require 'bunny'
require 'franz'

Thread.abort_on_exception = true

configs_one = [{
  type: :one,
  includes: [
    '/Users/sclemmer/Desktop/birch/tmp/test.1*',
    '/Users/sclemmer/Desktop/birch/tmp/test.2*',
    '/Users/sclemmer/Desktop/birch/tmp/test.3*'
  ]
}]

configs_two = [{
  type: :two,
  includes: [
    '/Users/sclemmer/Desktop/birch/tmp/test.4*',
    '/Users/sclemmer/Desktop/birch/tmp/test.5*',
    '/Users/sclemmer/Desktop/birch/tmp/test.6*',
    '/Users/sclemmer/Desktop/birch/tmp/test.7*',
    '/Users/sclemmer/Desktop/birch/tmp/test.8*',
    '/Users/sclemmer/Desktop/birch/tmp/test.9*'
  ],
}]

input = Queue.new

Franz::Input.new queue: input, configs: configs_one, \
  disover_interval: 5, watch_interval: 2, eviction_interval: 10, flush_interval: 5

Franz::Input.new queue: input, configs: configs_two, \
  disover_interval: 5, watch_interval: 2, eviction_interval: 10, flush_interval: 5

START = Time.now
LIMIT = ARGV.first.to_i
# i = 0
# until i == LIMIT
#   input.shift
#   i += 1
# end
Franz::Output.new input: input, limit: LIMIT, foreground: true
ELAPSED = Time.now - START

$stderr.puts 'num events: %d [E]' % LIMIT
$stderr.puts 'time elapsed: %.2f [s]' % ELAPSED
$stderr.puts 'throughput: %.1f [E/s]' % [ LIMIT / ELAPSED ]